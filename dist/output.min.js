(function(){
'use strict';for(var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)},d="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,h=["Array","prototype","fill"],l=0;l<h.length-1;l++){var m=h[l];m in d||(d[m]={});d=d[m]}
var p=h[h.length-1],q=d[p],r=q?q:function(b,a,c){var f=this.length||0;0>a&&(a=Math.max(0,f+a));if(null==c||c>f)c=f;c=Number(c);0>c&&(c=Math.max(0,f+c));for(a=Number(a||0);a<c;a++)this[a]=b;return this};r!=q&&null!=r&&aa(d,p,{configurable:!0,writable:!0,value:r});var t,u,v,w=[];
function x(){var b=u+Math.floor(Math.random()*v);if(b>=w.length)console.log("finished");else{var a=w[b];w.splice(b,1);v--;0==t%3&&(u+=v,v=6);document.getElementById("levelDisplay").innerHTML="Level "+t+"<br/>seed :"+a;y(a)}};var z=0,A=[],B;function C(){for(var b=[],a=0;a<A.length;a++)b=b.concat(D(A[a])),console.log("test "+D(A[a]));B=btoa(String.fromCharCode.apply(null,new Uint8Array(b)));console.log(b);document.getElementById("code").value=B}
function ba(){if(!(z>=A.length)){var b=function(a){return document.getElementById(a)},a=A[z];a.x=b("posX").value;0>a.x&&(a.x=0);1024<a.x&&(a.x=1024);b("posX").value=a.x;a.y=b("posY").value;0>a.y&&(a.y=0);1024<a.y&&(a.y=1024);b("posY").value=a.y;a.target=b("target").value;a.f=b("firstMult").value;a.g=b("secondMult").value;a.h=b("fireRate").value;a.b=b("bulletType").value;a.j=b("movement").value;a.l=b("movementType").value;a.speed=b("speed").value;a.start=b("start").value;0>a.start&&(a.start=0);a.start>
Math.pow(2,16)-8&&(a.start=Math.pow(2,16)-8);b("start").value=a.start;a.duration=b("duration").value;0>a.duration&&(a.duration=0);a.duration>Math.pow(2,16)-8&&(a.duration=Math.pow(2,16)-8);b("duration").value=a.duration;C()}}function ca(){console.log("pushed");A.push(new E);da()}function ea(){y(B)}
function fa(b){function a(a){return document.getElementById(a)}z=b;b=A[z];a("posX").value=b.x;a("posY").value=b.y;a("target").value=b.target;a("firstMult").value=b.f;a("secondMult").value=b.g;a("fireRate").value=b.h;a("bulletType").value=b.b;a("movement").value=b.j;a("movementType").value=b.l;a("speed").value=b.speed;a("start").value=b.start;a("duration").value=b.duration}
function ha(){var b=document.getElementById("load").value;try{var a=ia(b);A=[];for(b=0;b<a.length/8;b++)A.push(new E(a.subarray(8*b,8*b+8)));da();fa(0);C()}catch(c){alert("invalid Data. Please check it.")}}function da(){for(var b="",a=0;a<A.length;a++)b+="<li onclick='editorDisplay("+a+")'>Ennemy "+a+"<span onclick='editorDeleteEnnemy("+a+")'>X</span></li>";document.getElementById("list").innerHTML=b}
function ja(b){A[z].x=Math.floor((b.clientX-F.offsetLeft)/F.offsetHeight*1E3);A[z].y=Math.floor((b.clientY-F.offsetTop)/F.offsetHeight*1E3);fa(z)};function E(b,a,c,f,k,n,H,I,g,e,sa){4==arguments.length?(this.x=b,this.y=a,this.duration=sa,this.target=c,this.h=f,this.f=k,this.g=n,this.b=H,this.j=I,this.l=0,this.speed=g):1==arguments.length?(this.x=b[0]<<2,this.y=b[1]<<2,this.target=(b[2]&253)>>2,this.h=b[2]&3,this.f=(b[3]&224)>>5,this.g=(b[3]&28)>>2,this.b=b[3]&3,this.j=(b[4]&240)>>4,this.l=(b[4]&12)>>2,this.speed=b[4]&3,this.start=(b[5]<<8)+(b[6]&240),this.duration=((b[6]&15)<<8)+b[7]<<4,console.log("init"+b[2]+" "+this.target)):this.duration=
this.start=this.speed=this.l=this.j=this.b=this.g=this.f=this.h=this.target=this.y=this.x=0;this.m=this.y;this.i=this.frame=this.c=this.a=0}function D(b){var a=[];console.log(b.target+" test");a.push(Math.floor(b.x>>2));a.push(Math.floor(b.y>>2));a.push((+b.target<<2)+ +b.h);a.push((b.f<<5)+(b.g<<2)+ +b.b);a.push((+b.j<<4)+(b.l<<2)+ +b.speed);a.push((b.start&65280)>>8);a.push((b.start&240)+Math.floor(b.duration>>12));a.push((b.duration&4080)>>4);return a}
function ka(b,a,c,f,k){this.x=b;this.y=a;this.type=0;this.direction=f;this.size=c;this.speed=k}var G=[],J=[],la="";function ia(b){try{return new Uint8Array(atob(b).split("").map(function(a){return a.charCodeAt(0)}))}catch(a){console.log("error decoding "+b)}}function y(b){K=L=500;la=b;G=[];J=[];b=ia(b);for(var a=0;a<b.length/8;a++)G.push(new E(b.subarray(8*a,8*a+8)))}
function M(){for(var b=0;b<G.length;b++){var a=G[b];a.i++;if(a.i>a.start&&a.i<a.start+a.duration){a.frame++;var c=void 0;switch(a.j){case 1:c=Math.atan2(K-a.y,L-a.x);break;case 2:c=3*Math.PI/2;break;case 3:c=Math.PI;break;case 4:c=0;break;case 5:c=Math.PI/2;break;case 6:var f=c=a.m;if(0==a.c||1==a.c)c=1E3-c;if(1==a.c||2==a.c)f=1E3-f;1>Math.abs(a.x-c)&&1>Math.abs(a.y-f)&&a.c++;3<a.c&&(a.c=0);c=Math.atan2(f-a.y,c-a.x);break;case 7:c=Math.atan2(1E3-K-a.y,1E3-L-a.x)}switch(a.l){case 1:c+=Math.sin(a.frame/
40);break;case 2:a.a=(a.a+2*Math.PI)%(2*Math.PI);c=(c+2*Math.PI)%(2*Math.PI);f=a.a-c;f=f>Math.PI?a.a<c?-1:1:a.a<c?1:-1;f=.03>Math.abs(a.a-c)?f*Math.abs(a.a-c):.03*f;c=a.a+f;a.a=c;console.log(f);break;case 3:c+=Math.sin(a.frame/10)/10}void 0!=c&&(a.x+=Math.cos(c)*(a.speed+1)/2,a.y+=Math.sin(c)*(a.speed+1)/2);if(1==a.frame%(72/(a.h+1))){c=[];switch(a.target){case 0:c.push(Math.atan2(K-a.y,L-a.x));break;case 1:c.push(a.frame/72);break;case 2:c.push(3*Math.PI/2);break;case 3:c.push(Math.PI);break;case 4:c.push(0);
break;case 5:c.push(Math.PI/2);break;case 6:b=(Math.atan2(K-a.y,L-a.x)-Math.PI/4+2*Math.PI)%(2*Math.PI);b=Math.floor(b/(Math.PI/2))*Math.PI/2+Math.PI/2;c.push(b);break;case 7:b=(Math.atan2(K-a.y,L-a.x)-3*Math.PI/8+2*Math.PI)%(2*Math.PI),b=Math.floor(b/(Math.PI/4))*Math.PI/4+Math.PI/2,c.push(b)}for(var k=0;2>k;k++){var n=[];Array.prototype.forEach.call(c,function(b){switch(0==k?a.f:a.g){case 0:n.push(b);break;case 1:for(var c=-.1;.15>c;c+=.1)n.push(b+c);break;case 2:for(c=-.3;.35>c;c+=.3)n.push(b+
c);break;case 3:for(c=-.2;.25>c;c+=.1)n.push(b+c);break;case 4:for(c=-.6;.65>c;c+=.3)n.push(b+c);break;case 5:for(c=0;c<Math.PI+1;c+=Math.PI)n.push(b+c);break;case 6:for(c=0;c<2*Math.PI;c+=Math.PI/2)n.push(b+c);break;case 7:for(c=0;c<2*Math.PI;c+=Math.PI/4)n.push(b+c)}});c=n}for(b=0;b<c.length;b++)J.push(new ka(a.x,a.y,5+a.b%2*5,c[b],2-1*Math.floor(a.b/2)))}}}for(b=0;b<J.length;b++)c=J[b],-50>c.x||1050<c.x||-50>c.y||1050<c.y?(J.splice(b,1),b--):0==c.type&&(c.x+=Math.cos(c.direction)*c.speed,c.y+=
Math.sin(c.direction)*c.speed)}function ma(){N("blue",10);O.strokeStyle="red";O.lineWidth=5;O.beginPath();for(var b=0;b<J.length;b++)-999!=J[b].x&&(O.moveTo(J[b].x,J[b].y),O.arc(J[b].x,J[b].y,J[b].size,0,2*Math.PI));O.stroke();O.fillStyle="red";O.beginPath();for(b=0;b<G.length;b++){var a=G[b];a.i>a.start-60&&a.i<a.start+a.duration&&(O.moveTo(a.x,a.y),O.arc(a.x,a.y,10,0,2*Math.PI))}O.fill()};var P=[];window.onkeyup=function(b){P[b.keyCode]=!1};window.onkeydown=function(b){P[b.keyCode]=!0};function N(b,a){O.shadowColor=b;O.shadowBlur=a;O.shadowOffsetX=0;O.shadowOffsetY=0}var Q="M 0 6 L 2 0 L 4 6 L 3 3 L 1 3;M 0 6 L 0 0 A 1 1 0 1 1 0 3 A 1.5 1 0 0 1 0 6 L 0 3;M 3 0 Q 0 0 0 4 Q 0 6 3 6 ;M 0 6 L 0 0 A 1 1 0 1 1 0 6 ;M 3 6 L 0 6 L 0 3 L 2 3 L 0 3 L 0 0 L 3 0 ;M 1 6 L 1 3 L 3 3 L 1 3 L 1 0 L 4 0;M 2 4 L 4 4 A 2 3 0 1 1 4 2 ;M 0 0 L 0 6 L 0 3 L 3 3 L 3 0 L 3 6 ;M 1 6 L 3 6 L 2 6 L 2 0 L 1 0 L 3 0 ;M 0 5 C 0 7 2 7 2 5 L 2 1 L 1 1 L 3 1 ;M 0 6 L 0 0 L 0 3 L 2 1 L 0 3 L 3 6;M 0 0 L 0 6 L 3 6 ;M 0 6 L 0 0 L 2 2 L 4 0 L 4 6 ;M 0 6 L 0 0 L 4 6 L 4 0 ;M 2 6 A 0.5 1 0 1 1 2 0 A 0.5 1 0 1 1 2 6 ;M 0 6 L 0 0 A 1.5 1 0 1 1 0 3 ;M 3 4 L 4 6 A 1 1 0 1 1 2 1 A 1 1 0 1 1 4 6 ;M 0 6 L 0 0 A 1 1 0 1 1 0 3 L 2 6 ;M 0 6 C 4 7 4 3 2 3 C 0 3 0 -1 3 0 ;M 2 6 L 2 0 L 0 0 L 4 0 ;M 0 0 Q 0 6 1.5 6 Q 3 6 3 0;M 0 0 L 2 6 L 4 0;M 0 0 L 1 6 L 2 0 L 3 6 L 4 0 ;M 0 0 L 4 6 L 2 3 L 0 6 L 4 0 ;M 0 0 L 2 3 L 0 6 L 4 0;M 0 0 L 4 0 L 0 6 L 4 6 ;M 1 0 C 3 0 5 2 3 3 C 1 3.5 2.5 4 2.5 5 ".split(";");
function R(b,a,c,f,k){if(!(0>f||f>8*c.length+k)){if(null==k||void 0==k)k=8*c.length+180;c=c.toLowerCase();O.save();O.lineWidth=.8;O.lineCap="round";O.lineJoin="round";O.translate(b,a);O.scale(3,3);N("white",5);for(b=0;b<c.length;b++)O.globalAlpha=f>8*b?Math.min((f-8*b)/30,1):0,f>k+8*b&&(O.globalAlpha=Math.max(0,Math.min(1-(f-(k+8*b))/30,1))),a=c.charCodeAt(b),63==a?a=26:32==a?a=-1:10==a?(a=-1,O.translate(-5*(b+1),12)):a-=97,-1!=a&&O.stroke(Q[a]),O.translate(5,0);O.restore()}};var O,F,na=1E3/60,S=0,T,U=4;
function oa(b){switch(b){case 1:t=1;u=0;v=6;K=L=500;w=["fX0DkAAAYD4=","fX0HkAAAYD4=","cHAbkWAAYD4=","fX0H5gAAYD4=","fX0D5wAAYD4=","Pj4DAAAAYD67uwMAAABgPg==","fX0DcAAAYD4=","Pj4DAAAAYD67uwMAAABgPj67AwAAAGA+uz4DAAAAYD4=","fX0H8gAAYD4=","V1cD5WMAYD4=","V1cH4GMAYD4=","fX0H5QMAYD4=","V1cH5GMAYD4=","fX0HfAAAYD4=","fX0HnwAAYD4=","fX0HnAAAYD4=","fX0HeQAAYD4=","Pj4COAAAYD4+uwLEAABgPrs+AsQAAGA+u7sCxAAAYD4=","Pj4COGIAYD4+uwLEYgBgPrs+AsRiAGA+u7sCxGIAYD4=","Pj4HxGIAYD67uwfEYgBgPg==","GRkGWGIAYD7h4QbEYgBgPg","fX0H7AIAYD4",
"fX0HxBkAYD4=","fX0HyxkAYD4=","fX0HGBsAYD4","fX0H5gAAYD59fQUcEABgPg","fX0H5BoAYD4=","GRkGPGIAYD7h4QbkYgBgPg","GRkGXGIAYD7h4QboYgBgPg","V1cH62MAYD4=","fX0HfwAAYD4=","GRkGxGoAYD5kZAZYYgBgPuHhBsRiAGA9",,"fX0HOBsAYD4="];x();b=U=5;break;case 2:var a=prompt("please enter the level code","Should look like b5cH5GEAbIE=");if(null==a||""==a){P[32]=!1;return}y(a);T=Date.now();break;case 3:G=[];J=[];document.getElementById("editor").style.display="flex";document.getElementById("canvas").classList.add("canvasEdit");
a="at the player;rotating;top;left;right;bottom;4 direction where player is;8 direction where player is".split(";");for(var c=["very slow","slow","medium","fast"],f="simple bullet;triple bullet close;triple bullet wide;5 bullet close;5 bullet wide;2 bullet in opposite direction;4 bullet in opposite direction;8 bullet in opposite direction".split(";"),k=["quick and small","quick and big","slow and small","slow and big"],n="fixed;go to player;top;left;right;bottom;rectangle centered in 500,500;opposite to the player".split(";"),
H=["straight","sine wave","slow turn"],I=["slow","normal","fast","very fast"],g="",e=0;e<a.length;e++)g+="<option value="+e+">"+a[e]+"</option>";document.getElementById("target").innerHTML=g;g="";for(e=0;e<f.length;e++)g+="<option value="+e+">"+f[e]+"</option>";document.getElementById("firstMult").innerHTML=g;document.getElementById("secondMult").innerHTML=g;g="";for(e=0;e<c.length;e++)g+="<option value="+e+">"+c[e]+"</option>";document.getElementById("fireRate").innerHTML=g;g="";for(e=0;e<k.length;e++)g+=
"<option value="+e+">"+k[e]+"</option>";document.getElementById("bulletType").innerHTML=g;g="";for(e=0;e<n.length;e++)g+="<option value="+e+">"+n[e]+"</option>";document.getElementById("movement").innerHTML=g;g="";for(e=0;e<H.length;e++)g+="<option value="+e+">"+H[e]+"</option>";document.getElementById("movementType").innerHTML=g;g="";for(e=0;e<I.length;e++)g+="<option value="+e+">"+I[e]+"</option>";document.getElementById("speed").innerHTML=g;ca();break;case 4:y("u7sG5AAAD/8="),L=-999}U=b}
function pa(){var b=Date.now();S+=b-T;for(T=b;S>=na;){switch(U){case 0:case 1:V++,1200<V&&(U=1);case 2:case 3:M();qa();break;case 4:W++;P[38]?(X&&Y--,X=!1):P[40]?(X&&Y++,X=!1):X=!0;Y=(Y+4)%4;P[32]&&oa(Y);M();break;case 5:M();qa();a:{for(b=0;b<G.length;b++){var a=G[b];if(a.i<a.start+a.duration){b=!1;break a}}b=0<J.length?!1:!0}b&&(t++,x())}S-=na}N("transparent",0);O.fillStyle="rgba(0,0,0,0.25)";O.rect(0,0,1E3,1E3);O.fill();O.fillStyle="rgba(0,0,0,1)";switch(U){case 0:case 1:R(50,400,"WHERE AM I?",
V),R(400,400," Everyone ask the same\nquestion when they arrive",V-300),R(50,400,"What are you\ntalking about??",V-600);case 2:case 3:case 5:ma();b=Z;N(ra?"blue":"white",10);O.lineWidth=4;O.strokeStyle="white";O.beginPath();O.arc(L,K,5,0,2*Math.PI);O.stroke();for(a=1;5>a;a++)O.globalAlpha=1/(a+1),O.beginPath(),O.arc(L,K,5+a*b/5,0,2*Math.PI),O.stroke();O.globalAlpha=1;break;case 4:ma();b=["Story","Arcade","Custom","Editor"];O.save();O.scale(5,5);O.strokeStyle="black";R(40,20,"Lost Soul",W,W+1);O.restore();
O.save();O.scale(2,2);for(a=0;4>a;a++)O.strokeStyle=a==Y?"rgba(255,255,255,"+(Math.sin(W/40)/8+.6)+")":"black",R(100,200+50*a,b[a],W,W+1);O.restore()}requestAnimationFrame(pa)}
window.onload=function(){document.getElementById("canvas").addEventListener("click",ja);document.getElementById("formEditor").addEventListener("change",ba);document.getElementById("buttonStart").addEventListener("click",ea);document.getElementById("buttonAdd").addEventListener("click",ca);document.getElementById("buttonLoad").addEventListener("click",ha);for(var b=0;b<Q.length;b++)Q[b]=new Path2D(Q[b]);F=document.getElementById("canvas");F.width=1E3;F.height=1E3;O=F.getContext("2d");T=Date.now();
pa();oa(4)};var W=0,Y=0,X=!0;var L=120,K=500,Z=10,ta=0,ra=!1;function qa(){var b=2;P[17]&&(b=1);P[38]&&(K-=b);P[40]&&(K+=b);P[37]&&(L-=b);P[39]&&(L+=b);ta++;1E3<L&&(L=1E3);0>L&&(L=0);1E3<K&&(K=1E3);0>K&&(K=0);0==U&&(Z+=Math.sin(ta/60)/15);1<=U&&0<Z&&(Z-=.2);ra=!1;a:{b=L;for(var a=K,c=0;c<J.length;c++)if(-999!=J[c].x&&(J[c].x-b)*(J[c].x-b)+(J[c].y-a)*(J[c].y-a)<25+J[c].size*J[c].size){b=!0;break a}b=void 0}b&&y(la)};var V=900;
}).call(this)
