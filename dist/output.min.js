(function(){
'use strict';for(var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)},d="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,h=["Array","prototype","fill"],l=0;l<h.length-1;l++){var m=h[l];m in d||(d[m]={});d=d[m]}
var p=h[h.length-1],q=d[p],r=q?q:function(b,a,c){var f=this.length||0;0>a&&(a=Math.max(0,f+a));if(null==c||c>f)c=f;c=Number(c);0>c&&(c=Math.max(0,f+c));for(a=Number(a||0);a<c;a++)this[a]=b;return this};r!=q&&null!=r&&aa(d,p,{configurable:!0,writable:!0,value:r});var t=0,u=[],v;function w(){for(var b=[],a=0;a<u.length;a++)b=b.concat(x(u[a])),console.log("test "+x(u[a]));v=btoa(String.fromCharCode.apply(null,new Uint8Array(b)));console.log(b);document.getElementById("code").value=v}
function ba(){if(!(t>=u.length)){var b=function(a){return document.getElementById(a)},a=u[t];a.x=b("posX").value;0>a.x&&(a.x=0);1024<a.x&&(a.x=1024);b("posX").value=a.x;a.y=b("posY").value;0>a.y&&(a.y=0);1024<a.y&&(a.y=1024);b("posY").value=a.y;a.target=b("target").value;a.f=b("firstMult").value;a.g=b("secondMult").value;a.h=b("fireRate").value;a.b=b("bulletType").value;a.i=b("movement").value;a.j=b("movementType").value;a.speed=b("speed").value;a.start=b("start").value;0>a.start&&(a.start=0);a.start>
Math.pow(2,16)-8&&(a.start=Math.pow(2,16)-8);b("start").value=a.start;a.duration=b("duration").value;0>a.duration&&(a.duration=0);a.duration>Math.pow(2,16)-8&&(a.duration=Math.pow(2,16)-8);b("duration").value=a.duration;w()}}function y(){console.log("pushed");u.push(new z);A()}function ca(){B(v)}
function C(b){function a(a){return document.getElementById(a)}t=b;b=u[t];a("posX").value=b.x;a("posY").value=b.y;a("target").value=b.target;a("firstMult").value=b.f;a("secondMult").value=b.g;a("fireRate").value=b.h;a("bulletType").value=b.b;a("movement").value=b.i;a("movementType").value=b.j;a("speed").value=b.speed;a("start").value=b.start;a("duration").value=b.duration}
function da(){u=[];var b=document.getElementById("load").value;console.log(b);b=D(b);for(var a=0;a<b.length/8;a++)u.push(new z(b.subarray(8*a,8*a+8)));A();C(0);w()}function A(){for(var b="",a=0;a<u.length;a++)b+="<li onclick='editorDisplay("+a+")'>Ennemy "+a+"<span onclick='editorDeleteEnnemy("+a+")'>X</span></li>";document.getElementById("list").innerHTML=b}
function ea(b){u[t].x=Math.floor((b.clientX-G.offsetLeft)/G.offsetHeight*1E3);u[t].y=Math.floor((b.clientY-G.offsetTop)/G.offsetHeight*1E3);C(t)};function z(b,a,c,f,k,n,E,F,g,e,na){4==arguments.length?(this.x=b,this.y=a,this.duration=na,this.target=c,this.h=f,this.f=k,this.g=n,this.b=E,this.i=F,this.j=0,this.speed=g):1==arguments.length?(this.x=b[0]<<2,this.y=b[1]<<2,this.target=(b[2]&253)>>2,this.h=b[2]&3,this.f=(b[3]&224)>>5,this.g=(b[3]&28)>>2,this.b=b[3]&3,this.i=(b[4]&240)>>4,this.j=(b[4]&12)>>2,this.speed=b[4]&3,this.start=(b[5]<<8)+(b[6]&240),this.duration=((b[6]&15)<<8)+b[7]<<4,console.log("init"+b[2]+" "+this.target)):this.duration=
this.start=this.speed=this.j=this.i=this.b=this.g=this.f=this.h=this.target=this.y=this.x=0;this.m=this.y;this.l=this.frame=this.c=this.a=0}function x(b){var a=[];console.log(b.target+" test");a.push(Math.floor(b.x>>2));a.push(Math.floor(b.y>>2));a.push((+b.target<<2)+ +b.h);a.push((b.f<<5)+(b.g<<2)+ +b.b);a.push((+b.i<<4)+(b.j<<2)+ +b.speed);a.push((b.start&65280)>>8);a.push((b.start&240)+Math.floor(b.duration>>12));a.push((b.duration&4080)>>4);return a}
function fa(b,a,c,f,k){this.x=b;this.y=a;this.type=0;this.direction=f;this.size=c;this.speed=k}var H=[],I=[],J="";function D(b){return new Uint8Array(atob(b).split("").map(function(a){return a.charCodeAt(0)}))}function B(b){K=L=500;J=b;H=[];I=[];b=D(b);for(var a=0;a<b.length/8;a++)H.push(new z(b.subarray(8*a,8*a+8)))}
function M(){for(var b=0;b<H.length;b++){var a=H[b];a.l++;if(a.l>a.start&&a.l<a.start+a.duration){a.frame++;var c=void 0;switch(a.i){case 1:c=Math.atan2(K-a.y,L-a.x);break;case 2:c=3*Math.PI/2;break;case 3:c=Math.PI;break;case 4:c=0;break;case 5:c=Math.PI/2;break;case 6:var f=c=a.m;if(0==a.c||1==a.c)c=1E3-c;if(1==a.c||2==a.c)f=1E3-f;1>Math.abs(a.x-c)&&1>Math.abs(a.y-f)&&a.c++;3<a.c&&(a.c=0);c=Math.atan2(f-a.y,c-a.x);break;case 7:c=Math.atan2(1E3-K-a.y,1E3-L-a.x)}switch(a.j){case 1:c+=Math.sin(a.frame/
40);break;case 2:a.a=(a.a+2*Math.PI)%(2*Math.PI);c=(c+2*Math.PI)%(2*Math.PI);f=a.a-c;f=f>Math.PI?a.a<c?-1:1:a.a<c?1:-1;f=.03>Math.abs(a.a-c)?f*Math.abs(a.a-c):.03*f;c=a.a+f;a.a=c;console.log(f);break;case 3:c+=Math.sin(a.frame/10)/10}void 0!=c&&(a.x+=Math.cos(c)*(a.speed+1)/2,a.y+=Math.sin(c)*(a.speed+1)/2);if(1==a.frame%(72/(a.h+1))){c=[];switch(a.target){case 0:c.push(Math.atan2(K-a.y,L-a.x));break;case 1:c.push(a.frame/72);break;case 2:c.push(3*Math.PI/2);break;case 3:c.push(Math.PI);break;case 4:c.push(0);
break;case 5:c.push(Math.PI/2);break;case 6:b=(Math.atan2(K-a.y,L-a.x)-Math.PI/4+2*Math.PI)%(2*Math.PI);b=Math.floor(b/(Math.PI/2))*Math.PI/2+Math.PI/2;c.push(b);break;case 7:b=(Math.atan2(K-a.y,L-a.x)-3*Math.PI/8+2*Math.PI)%(2*Math.PI),b=Math.floor(b/(Math.PI/4))*Math.PI/4+Math.PI/2,c.push(b)}for(var k=0;2>k;k++){var n=[];Array.prototype.forEach.call(c,function(b){switch(0==k?a.f:a.g){case 0:n.push(b);break;case 1:for(var c=-.1;.15>c;c+=.1)n.push(b+c);break;case 2:for(c=-.3;.35>c;c+=.3)n.push(b+
c);break;case 3:for(c=-.2;.25>c;c+=.1)n.push(b+c);break;case 4:for(c=-.6;.65>c;c+=.3)n.push(b+c);break;case 5:for(c=0;c<Math.PI+1;c+=Math.PI)n.push(b+c);break;case 6:for(c=0;c<2*Math.PI;c+=Math.PI/2)n.push(b+c);break;case 7:for(c=0;c<2*Math.PI;c+=Math.PI/4)n.push(b+c)}});c=n}for(b=0;b<c.length;b++)I.push(new fa(a.x,a.y,5+a.b%2*5,c[b],2-1*Math.floor(a.b/2)))}}}for(b=0;b<I.length;b++)c=I[b],-50>c.x||1050<c.x||-50>c.y||1050<c.y?(I.splice(b,1),b--):0==c.type&&(c.x+=Math.cos(c.direction)*c.speed,c.y+=
Math.sin(c.direction)*c.speed)}function ha(){N("blue",10);O.strokeStyle="red";O.lineWidth=5;O.beginPath();for(var b=0;b<I.length;b++)-999!=I[b].x&&(O.moveTo(I[b].x,I[b].y),O.arc(I[b].x,I[b].y,I[b].size,0,2*Math.PI));O.stroke();O.fillStyle="red";O.beginPath();for(b=0;b<H.length;b++){var a=H[b];a.l>a.start-60&&a.l<a.start+a.duration&&(O.moveTo(a.x,a.y),O.arc(a.x,a.y,10,0,2*Math.PI))}O.fill()};var P=[];window.onkeyup=function(b){P[b.keyCode]=!1};window.onkeydown=function(b){P[b.keyCode]=!0};function N(b,a){O.shadowColor=b;O.shadowBlur=a;O.shadowOffsetX=0;O.shadowOffsetY=0}var Q="M 0 6 L 2 0 L 4 6 L 3 3 L 1 3;M 0 6 L 0 0 A 1 1 0 1 1 0 3 A 1.5 1 0 0 1 0 6 L 0 3;M 3 0 Q 0 0 0 4 Q 0 6 3 6 ;M 0 6 L 0 0 A 1 1 0 1 1 0 6 ;M 3 6 L 0 6 L 0 3 L 2 3 L 0 3 L 0 0 L 3 0 ;M 1 6 L 1 3 L 3 3 L 1 3 L 1 0 L 4 0;M 2 4 L 4 4 A 2 3 0 1 1 4 2 ;M 0 0 L 0 6 L 0 3 L 3 3 L 3 0 L 3 6 ;M 1 6 L 3 6 L 2 6 L 2 0 L 1 0 L 3 0 ;M 0 5 C 0 7 2 7 2 5 L 2 1 L 1 1 L 3 1 ;M 0 6 L 0 0 L 0 3 L 2 1 L 0 3 L 3 6;M 0 0 L 0 6 L 3 6 ;M 0 6 L 0 0 L 2 2 L 4 0 L 4 6 ;M 0 6 L 0 0 L 4 6 L 4 0 ;M 2 6 A 0.5 1 0 1 1 2 0 A 0.5 1 0 1 1 2 6 ;M 0 6 L 0 0 A 1.5 1 0 1 1 0 3 ;M 3 4 L 4 6 A 1 1 0 1 1 2 1 A 1 1 0 1 1 4 6 ;M 0 6 L 0 0 A 1 1 0 1 1 0 3 L 2 6 ;M 0 6 C 4 7 4 3 2 3 C 0 3 0 -1 3 0 ;M 2 6 L 2 0 L 0 0 L 4 0 ;M 0 0 Q 0 6 1.5 6 Q 3 6 3 0;M 0 0 L 2 6 L 4 0;M 0 0 L 1 6 L 2 0 L 3 6 L 4 0 ;M 0 0 L 4 6 L 2 3 L 0 6 L 4 0 ;M 0 0 L 2 3 L 0 6 L 4 0;M 0 0 L 4 0 L 0 6 L 4 6 ;M 1 0 C 3 0 5 2 3 3 C 1 3.5 2.5 4 2.5 5 ".split(";");
function R(b,a,c,f,k){if(!(0>f||f>8*c.length+k)){if(null==k||void 0==k)k=8*c.length+180;c=c.toLowerCase();O.save();O.lineWidth=.8;O.lineCap="round";O.lineJoin="round";O.translate(b,a);O.scale(3,3);N("white",5);for(b=0;b<c.length;b++)O.globalAlpha=f>8*b?Math.min((f-8*b)/30,1):0,f>k+8*b&&(O.globalAlpha=Math.max(0,Math.min(1-(f-(k+8*b))/30,1))),a=c.charCodeAt(b),63==a?a=26:32==a?a=-1:10==a?(a=-1,O.translate(-5*(b+1),12)):a-=97,-1!=a&&O.stroke(Q[a]),O.translate(5,0);O.restore()}};var O,G,ia=1E3/60,S=0,T,U=4;
function ja(b){switch(b){case 1:U=5;break;case 2:var a=prompt("please enter the level code","Should look like b5cH5GEAbIE=");if(null==a||""==a){P[32]=!1;return}B(a);T=Date.now();break;case 3:document.getElementById("editor").style.display="flex";document.getElementById("canvas").classList.add("canvasEdit");a="at the player;rotating;top;left;right;bottom;4 direction where player is;8 direction where player is".split(";");for(var c=["very slow","slow","medium","fast"],f="simple bullet;triple bullet close;triple bullet wide;5 bullet close;5 bullet wide;2 bullet in opposite direction;4 bullet in opposite direction;8 bullet in opposite direction".split(";"),
k=["quick and small","quick and big","slow and small","slow and big"],n="fixed;go to player;top;left;right;bottom;rectangle centered in 500,500;opposite to the player".split(";"),E=["straight","sine wave","slow turn"],F=["slow","normal","fast","very fast"],g="",e=0;e<a.length;e++)g+="<option value="+e+">"+a[e]+"</option>";document.getElementById("target").innerHTML=g;g="";for(e=0;e<f.length;e++)g+="<option value="+e+">"+f[e]+"</option>";document.getElementById("firstMult").innerHTML=g;document.getElementById("secondMult").innerHTML=
g;g="";for(e=0;e<c.length;e++)g+="<option value="+e+">"+c[e]+"</option>";document.getElementById("fireRate").innerHTML=g;g="";for(e=0;e<k.length;e++)g+="<option value="+e+">"+k[e]+"</option>";document.getElementById("bulletType").innerHTML=g;g="";for(e=0;e<n.length;e++)g+="<option value="+e+">"+n[e]+"</option>";document.getElementById("movement").innerHTML=g;g="";for(e=0;e<E.length;e++)g+="<option value="+e+">"+E[e]+"</option>";document.getElementById("movementType").innerHTML=g;g="";for(e=0;e<F.length;e++)g+=
"<option value="+e+">"+F[e]+"</option>";document.getElementById("speed").innerHTML=g;y();break;case 4:B("u7sG5AAAD/8="),L=-999}U=b}
function ka(){var b=Date.now();S+=b-T;for(T=b;S>=ia;){switch(U){case 0:case 1:V++,1200<V&&(U=1);case 2:case 3:M();la();break;case 4:W++;P[38]?(X&&Y--,X=!1):P[40]?(X&&Y++,X=!1):X=!0;Y=(Y+4)%4;P[32]&&ja(Y);M();break;case 5:M(),la()}S-=ia}N("transparent",0);O.fillStyle="rgba(0,0,0,0.25)";O.rect(0,0,1E3,1E3);O.fill();O.fillStyle="rgba(0,0,0,1)";switch(U){case 0:case 1:R(50,400,"WHERE AM I?",V),R(400,400," Everyone ask the same\nquestion when they arrive",V-300),R(50,400,"What are you\ntalking about??",
V-600);case 2:case 3:ha();b=Z;N(ma?"blue":"white",10);O.lineWidth=4;O.strokeStyle="white";O.beginPath();O.arc(L,K,5,0,2*Math.PI);O.stroke();for(var a=1;5>a;a++)O.globalAlpha=1/(a+1),O.beginPath(),O.arc(L,K,5+a*b/5,0,2*Math.PI),O.stroke();O.globalAlpha=1;break;case 4:ha();b=["Story","Arcade","Custom","Editor"];O.save();O.scale(5,5);O.strokeStyle="black";R(40,20,"Lost Soul",W,W+1);O.restore();O.save();O.scale(2,2);for(a=0;4>a;a++)O.strokeStyle=a==Y?"rgba(255,255,255,"+(Math.sin(W/40)/8+.6)+")":"black",
R(100,200+50*a,b[a],W,W+1);O.restore()}requestAnimationFrame(ka)}
window.onload=function(){document.getElementById("canvas").addEventListener("click",ea);document.getElementById("formEditor").addEventListener("change",ba);document.getElementById("buttonStart").addEventListener("click",ca);document.getElementById("buttonAdd").addEventListener("click",y);document.getElementById("buttonLoad").addEventListener("click",da);for(var b=0;b<Q.length;b++)Q[b]=new Path2D(Q[b]);G=document.getElementById("canvas");G.width=1E3;G.height=1E3;O=G.getContext("2d");T=Date.now();ka();
ja(4)};var W=0,Y=0,X=!0;var L=120,K=500,Z=10,oa=0,ma=!1;function la(){var b=2;P[17]&&(b=1);P[38]&&(K-=b);P[40]&&(K+=b);P[37]&&(L-=b);P[39]&&(L+=b);oa++;1E3<L&&(L=1E3);0>L&&(L=0);1E3<K&&(K=1E3);0>K&&(K=0);0==U&&(Z+=Math.sin(oa/60)/15);1<=U&&0<Z&&(Z-=.2);ma=!1;a:{b=L;for(var a=K,c=0;c<I.length;c++)if(-999!=I[c].x&&(I[c].x-b)*(I[c].x-b)+(I[c].y-a)*(I[c].y-a)<25+I[c].size*I[c].size){b=!0;break a}b=void 0}b&&B(J)};var V=900;
}).call(this)
